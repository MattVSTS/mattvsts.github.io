---
layout: post
title: Things to remember when you work with Azure and the new Team Build
date: '2015-12-06T16:09:00.001Z'
author: Matteo Emili
tags: 
modified_time: '2015-12-06T16:12:41.036Z'
thumbnail: http://lh3.googleusercontent.com/-FyUnAYDxoHw/VmRdxMvf_9I/AAAAAAAACps/LqViIv3b6HY/s72-c/wlEmoticon-smile%25255B2%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-7614270378671685402
blogger_orig_url: https://mattvsts.blogspot.com/2015/12/things-to-remember-when-you-work-with.html
---

<p>Azure is an amazing piece of technology – its capabilities are immense and there is always something new to learn and use for solving our problems.</p> <p>It is quite a while I am spending time on it, together with the new Team Build and a few other bits and pieces all around. I thought about summarising these little issues you might face as well, so you should save some time <img class="wlEmoticon wlEmoticon-smile" style="border-top-style: none; border-bottom-style: none; border-right-style: none; border-left-style: none" alt="Smile" src="http://lh3.googleusercontent.com/-FyUnAYDxoHw/VmRdxMvf_9I/AAAAAAAACps/LqViIv3b6HY/wlEmoticon-smile%25255B2%25255D.png?imgmax=800"></p> <p>First of all, please remember this: if you don’t have a build task OOB, and you don’t want to write your own, you can still use <strong>PowerShell</strong>! Never forget how powerful it is, because it can be used in literally thousands of ways.</p> <p>If you are working with TFS 2015 RTM you won’t have the new build tasks bundled with the Update 1 or support for Service Principals, but don’t worry – you can achieve the same results with a bit of PowerShell.</p> <p>For example, bearing in mind that creating a Service Principal for your Azure Active Directory is as easy as the first part (steps 1, 2 and 3) of this <a href="http://blogs.msdn.com/b/visualstudioalm/archive/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-build-release-management.aspx">blog post</a>, this is all you need to do in a PowerShell script to use the Service Principal for authentication:</p> <p><a href="http://lh3.googleusercontent.com/-gP-mq9XT25o/VmRdxq_2f8I/AAAAAAAACp4/okTIpyEZ9vc/s1600-h/image%25255B6%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh3.googleusercontent.com/-lV_NqPycddo/VmRdyUBAdcI/AAAAAAAACqE/LfTjIWOn2pw/image_thumb%25255B4%25255D.png?imgmax=800" width="504" height="76"></a></p> <p>At the moment support for Service Principals is limited to <strong>Azure Resource Manager</strong>, so for deploying any components you might want you still need to rely on the <em>old </em>certificate-based authentication.</p> <p>The <em>issue </em>here is that the combobox in the build task for Web App Deployment (VSTS or TFS 2015.1) <strong>doesn’t specify</strong> anything like that. What I suggest is to follow the following approach and add the Azure subscription with both authentications:</p> <p><a href="http://lh3.googleusercontent.com/-uHw7lpKDoB0/VmRdy-uZBjI/AAAAAAAACqQ/GDnaanoFVaQ/s1600-h/image%25255B9%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh3.googleusercontent.com/-2VnoH92QZE0/VmRdziCdBVI/AAAAAAAACqY/5j15Vae_WVg/image_thumb%25255B5%25255D.png?imgmax=800" width="244" height="190"></a></p> <p>So you would get a subscription in the comboboxes anyway, regardless of the <strong>authentication method</strong> you chose.</p> <p>Eventually, bear in mind that the new build agents expose capabilities – so if you want a specific agent with Azure PowerShell installed you would need to specify <strong>AzurePS </strong>as a demand in the build definition.</p>  