---
layout: post
title: Big changes in Azure DevOps Server 2019 - SQL Azure Database support
date: '2018-11-21T18:39:00.002Z'
author: Matteo Emili
tags: 
modified_time: '2018-11-21T18:39:43.811Z'
thumbnail: https://2.bp.blogspot.com/-GS0IyZ1kFi0/W_Wk5xA-qUI/AAAAAAAAFJs/hYbBYIkF3Do2upbmwp3xE08OKnE2ItXQQCLcBGAs/s72-c/azdos4.png
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-4954710379214623597
blogger_orig_url: https://mattvsts.blogspot.com/2018/11/big-changes-in-azure-devops-server-2019.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div>This is the first of a (hopefully!) series of posts looking at the substantial new features of Azure DevOps Server, which was released yesterday in <a href="https://azure.microsoft.com/services/devops/server">RC1</a>.</div><div><br /></div>If you follow my blog you know that despite everything going on around Azure DevOps Services, I have a soft spot for Azure DevOps Server (formerly Team Foundation Server) - the on-premise product.<div><br /></div><div>Why? Well, since it is a quarterly snapshot of the code from the service it seems excellent value in terms of what it offers once brought on-premise!</div><div><br /></div><div>This is quite an important feature I reckon: Azure DevOps Server now supports Azure SQL Database as the Data Tier.</div><div><br /></div><div><a href="https://2.bp.blogspot.com/-GS0IyZ1kFi0/W_Wk5xA-qUI/AAAAAAAAFJs/hYbBYIkF3Do2upbmwp3xE08OKnE2ItXQQCLcBGAs/s1600/azdos4.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="623" data-original-width="906" height="275" src="https://2.bp.blogspot.com/-GS0IyZ1kFi0/W_Wk5xA-qUI/AAAAAAAAFJs/hYbBYIkF3Do2upbmwp3xE08OKnE2ItXQQCLcBGAs/s400/azdos4.png" width="400" /></a><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div>I can already see you are scratching your head, a little puzzled. Let's put some red lines here, shall we? This configuration works (not "is supported" - works!) only when you are running an Azure DevOps Server instance in an Azure VM. So this is already a huge restriction, but it makes sense - you cannot have better connectivity than something already within the Azure datacentre. After all, on-premise does not necessarily need to be inside a wholly-owned datacentre.</div><div><br /></div><div>Also, when you create the Application Tier VM(s) you need to assign a <b>System assigned Managed Identity</b>&nbsp;to it - this is how the VM will authenticate with your database, and this is what will enable the Azure option in the deployment screen you saw before.</div><div><br /></div><div><a href="https://3.bp.blogspot.com/-z_VPR73MISk/W_Wk5atctcI/AAAAAAAAFJk/4BRKY-px0uAVKgDUytFV-xrxxMiWz3mhQCLcBGAs/s1600/azdos1.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="441" data-original-width="436" src="https://3.bp.blogspot.com/-z_VPR73MISk/W_Wk5atctcI/AAAAAAAAFJk/4BRKY-px0uAVKgDUytFV-xrxxMiWz3mhQCLcBGAs/s1600/azdos1.PNG" /></a></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div>Also, you need to provision at least two empty databases in advance: the Configuration database (name it Tfs_Configuration, for now) and the main Collection database (again, Tfs_DefaultCollection?). Once you have these two up and running, you need to set an AAD administrator user and assign these roles to your databases:</div><div><br /></div><div><a href="https://3.bp.blogspot.com/-bM_OyUB3bEA/W_Wk5UpVs9I/AAAAAAAAFJo/A0S7E-D5WNoQT-a5QHso-rOLl5o3q3yzACLcBGAs/s1600/azdos2.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="83" data-original-width="333" src="https://3.bp.blogspot.com/-bM_OyUB3bEA/W_Wk5UpVs9I/AAAAAAAAFJo/A0S7E-D5WNoQT-a5QHso-rOLl5o3q3yzACLcBGAs/s1600/azdos2.png" /></a></div><div><br /></div><div><a href="https://3.bp.blogspot.com/-cDq76KbUDoc/W_Wk5agdeCI/AAAAAAAAFJg/Veq_mAStZ74nxOjeTJueBHADR1Vn1xg-gCLcBGAs/s1600/azdos3.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="45" data-original-width="322" src="https://3.bp.blogspot.com/-cDq76KbUDoc/W_Wk5agdeCI/AAAAAAAAFJg/Veq_mAStZ74nxOjeTJueBHADR1Vn1xg-gCLcBGAs/s1600/azdos3.png" /></a><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div>AT here is the name of the VM, as you are leveraging on the system assigned managed identity. AAD is required to actually manipulate the databases. Also, the first SQL script needs to run only against the <b>master</b>&nbsp;database, while the second one should run against the Configuration database and the Collection database.</div><div><br /></div><div><a href="https://4.bp.blogspot.com/-FgskhdwgAko/W_Wk6edYssI/AAAAAAAAFJw/82Xd4Eg0mJchELixyg9wU9jPEmRaRln5gCLcBGAs/s1600/azdos6.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="623" data-original-width="907" height="274" src="https://4.bp.blogspot.com/-FgskhdwgAko/W_Wk6edYssI/AAAAAAAAFJw/82Xd4Eg0mJchELixyg9wU9jPEmRaRln5gCLcBGAs/s400/azdos6.png" width="400" /></a></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div>&nbsp;</div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div>What if you don't run these? The wizard put a series of checks in place to prevent a botched configuration. Hence, if you don't run the first script you are not allowing the VM to authenticate against the Azure SQL Database Server, causing this error:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-TUGpaNQlU10/W_Wk6jy_KDI/AAAAAAAAFJ0/E2OykAmAuqIIsq5YMmxTPYy2SlmTkwbMQCLcBGAs/s1600/azdos7.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="165" data-original-width="482" src="https://1.bp.blogspot.com/-TUGpaNQlU10/W_Wk6jy_KDI/AAAAAAAAFJ0/E2OykAmAuqIIsq5YMmxTPYy2SlmTkwbMQCLcBGAs/s1600/azdos7.png" /></a></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div>Without the second script you will get an explicit error during the Readiness Checks. Eventually, all databases should run an S3 tier or above, otherwise you will be prevented to configure the instance (for the Configuration database) or you will get various errors and your collection will not be provisioned.</div><div><br /></div><div><a href="https://4.bp.blogspot.com/-s29cTi2nBMI/W_Wk6yyZx6I/AAAAAAAAFJ4/tzcd6ZYHyVkl3HDSRIxgJZyMRGLJevKJACLcBGAs/s1600/azdos8.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="99" data-original-width="688" height="56" src="https://4.bp.blogspot.com/-s29cTi2nBMI/W_Wk6yyZx6I/AAAAAAAAFJ4/tzcd6ZYHyVkl3HDSRIxgJZyMRGLJevKJACLcBGAs/s400/azdos8.png" width="400" /></a></div><div><br /></div><div>&nbsp;</div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div>Why all of this? Put yourself in the shoes of someone who deals with a 3TB Collection on a daily basis. Backups, storage, DBCC, hardware performance and high availability. Can you see the reasons why? ðŸ˜€</div><div><br /></div><div><br /></div></div>