---
layout: post
title: On-premise rolling deployments with TFS 2018 Update 2
date: '2018-04-04T14:40:00.000+01:00'
author: Matteo Emili
tags: 
modified_time: '2018-04-04T14:40:24.349+01:00'
thumbnail: https://2.bp.blogspot.com/-rf435yzH_sE/WsTVVWUTULI/AAAAAAAAE4k/VAhAw3fHjDwSZNxx56dvWdhJEV8Qc2gXgCLcBGAs/s72-c/dg0.PNG
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-2976828102705090133
blogger_orig_url: https://mattvsts.blogspot.com/2018/04/on-premise-rolling-deployments-with-tfs.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br /><div class="MsoNormal">Team Foundation Server <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/tfs2018-update2">delivers</a>– as usual – the periodic snapshot of VSTS goodness on-premise.<o:p></o:p></div><div class="MsoNormal">One particular feature I am really happy landed in our datacentres is Deployment Groups. With it you can target sets of machines where you are going to deploy your applications on.<o:p></o:p></div><div class="MsoNormal"><br /></div><div class="MsoNormal">It is really amazing because it enables scenarios like Rolling Deployments for your existing applications running on-premise. These patterns are not an exclusive of the big boys!<o:p></o:p></div><div class="MsoNormal"><br /></div><div class="MsoNormal">For example, I am targeting a two node cluster with a very simple ASP.NET MVC application (running on full .NET Framework, so no .NET Core or anything that fancy, pretty much the run of the mill internal application you might find in pretty much any company) like this:<o:p></o:p></div><div class="MsoNormal"><span style="mso-no-proof: yes;"><!--[if gte vml 1]><v:shapetype  id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"  path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f"> <v:stroke joinstyle="miter"/> <v:formulas>  <v:f eqn="if lineDrawn pixelLineWidth 0"/>  <v:f eqn="sum @0 1 0"/>  <v:f eqn="sum 0 0 @1"/>  <v:f eqn="prod @2 1 2"/>  <v:f eqn="prod @3 21600 pixelWidth"/>  <v:f eqn="prod @3 21600 pixelHeight"/>  <v:f eqn="sum @0 0 1"/>  <v:f eqn="prod @6 1 2"/>  <v:f eqn="prod @7 21600 pixelWidth"/>  <v:f eqn="sum @8 21600 0"/>  <v:f eqn="prod @7 21600 pixelHeight"/>  <v:f eqn="sum @10 21600 0"/> </v:formulas> <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/> <o:lock v:ext="edit" aspectratio="t"/></v:shapetype><v:shape id="Picture_x0020_1" o:spid="_x0000_i1028" type="#_x0000_t75"  style='width:451.5pt;height:361.5pt;visibility:visible;mso-wrap-style:square'> <v:imagedata src="file:///C:/Users/MATTEO~1.ACM/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png"   o:title=""/></v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><o:p></o:p></div><div class="MsoNormal"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-rf435yzH_sE/WsTVVWUTULI/AAAAAAAAE4k/VAhAw3fHjDwSZNxx56dvWdhJEV8Qc2gXgCLcBGAs/s1600/dg0.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="452" data-original-width="580" height="311" src="https://2.bp.blogspot.com/-rf435yzH_sE/WsTVVWUTULI/AAAAAAAAE4k/VAhAw3fHjDwSZNxx56dvWdhJEV8Qc2gXgCLcBGAs/s400/dg0.PNG" width="400" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><br /></div><div class="MsoNormal">I am targeting one server at a time – it comes as a simple option but this is crucial, as you could do them in parallel.<o:p></o:p></div><div class="MsoNormal"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-KyDX5zKyj5w/WsTVh3Bz7rI/AAAAAAAAE4s/p-a6P72Jz3Mizej4gDm8_ve4E62VWf_rgCLcBGAs/s1600/dg1.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="98" data-original-width="400" src="https://3.bp.blogspot.com/-KyDX5zKyj5w/WsTVh3Bz7rI/AAAAAAAAE4s/p-a6P72Jz3Mizej4gDm8_ve4E62VWf_rgCLcBGAs/s1600/dg1.png" /></a></div><br /><br /><br /><br /><br /><br />  <div class="MsoNormal"><span style="mso-no-proof: yes;"><!--[if gte vml 1]><v:shape  id="Picture_x0020_2" o:spid="_x0000_i1027" type="#_x0000_t75" style='width:300pt;  height:72.75pt;visibility:visible;mso-wrap-style:square'> <v:imagedata src="file:///C:/Users/MATTEO~1.ACM/AppData/Local/Temp/msohtmlclip1/01/clip_image003.png"   o:title=""/></v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><o:p></o:p></div><div class="MsoNormal"><br /></div><div class="MsoNormal">Then it is fairly straightforward: stop the node draining all the connections (this is quite important) stop the website, deploy the package via the trusted MSDeploy, restart the website and re-join the node.<o:p></o:p></div><div class="MsoNormal"><br /></div><div class="MsoNormal">To handle the cluster nodes, you can easily use the NLB PowerShell cmdlets:<o:p></o:p></div><div class="MsoNormal"><span style="mso-no-proof: yes;"><!--[if gte vml 1]><v:shape  id="Picture_x0020_3" o:spid="_x0000_i1026" type="#_x0000_t75" style='width:3in;  height:46.5pt;visibility:visible;mso-wrap-style:square'> <v:imagedata src="file:///C:/Users/MATTEO~1.ACM/AppData/Local/Temp/msohtmlclip1/01/clip_image004.png"   o:title=""/></v:shape><![endif]--><!--[if !vml]--><!--[endif]--><!--[if gte vml 1]><v:shape id="Picture_x0020_4"  o:spid="_x0000_i1025" type="#_x0000_t75" style='width:132pt;height:42pt;  visibility:visible;mso-wrap-style:square'> <v:imagedata src="file:///C:/Users/MATTEO~1.ACM/AppData/Local/Temp/msohtmlclip1/01/clip_image005.png"   o:title=""/></v:shape><![endif]--><!--[if !vml]--><!--[endif]--></span><o:p></o:p></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><a href="https://3.bp.blogspot.com/-ZAjrD3aqKb8/WsTVhx-7GlI/AAAAAAAAE4o/IuFewJRiP-g0a-QE282NuTYuA9JlOkxTgCLcBGAs/s1600/dg2.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="62" data-original-width="288" src="https://3.bp.blogspot.com/-ZAjrD3aqKb8/WsTVhx-7GlI/AAAAAAAAE4o/IuFewJRiP-g0a-QE282NuTYuA9JlOkxTgCLcBGAs/s1600/dg2.PNG" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal">This Release definition is going to run against each of the nodes, making individual node management very easy. Of course it is just a starting point and I am simplifying some of the situations you might find, but all the foundation is there!<o:p></o:p></div><br /></div>