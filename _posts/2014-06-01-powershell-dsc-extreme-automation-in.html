---
layout: post
title: PowerShell DSC – extreme automation in a DevOps world
date: '2014-06-01T07:32:00.001+01:00'
author: Matteo Emili
tags: 
modified_time: '2014-06-01T07:32:51.254+01:00'
thumbnail: http://lh4.ggpht.com/-HQcb_i92FEQ/U4rJEenYfII/AAAAAAAABY4/_n3w8ICbnfU/s72-c/wlEmoticon-smile2.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-3961590765265833556
blogger_orig_url: https://mattvsts.blogspot.com/2014/06/powershell-dsc-extreme-automation-in.html
---

<p>Release Management <strong>Update 3 CTP1</strong> introduces support to <strong>PowerShell Desired State Configuration</strong> to deploy applications in your environments – this is utterly cool, but…<strong>why</strong>?</p> <p>Before looking at VSRM itself, I think a bit of introduction to DSC is needed.</p> <p>PowerShell Desired State Configuration is a <strong>new management platform</strong> built-in in Windows and based on, guess what, <strong>PowerShell</strong>. It can do a bunch of useful tasks, which I leave to the <a href="http://technet.microsoft.com/en-us/library/dn249912.aspx">documentation</a> because I just want to dig into the core concepts.</p> <p>As it is built-in in Windows, <strong>it is <em>agentless</em></strong>. Well actually the agent is inside PowerShell and Windows Management Framework, but for our purpose (deployments) we can consider whatever system running <strong>PowerShell 4.0+</strong> (so Windows Server 2008 R2 and above, just by installing PS 4.0 and WMF 4.0) a <strong>DSC-capable system.</strong></p> <p>All of that goodness relies on a keyword – <strong>Configuration</strong>. If you set a Configuration block at the beginning of the script, you are invoking DSC. </p> <p>DSC uses a .mof file which is created by the script itself, so after creating and running the script you just need to call Start-DscConfiguration with the appropriate parameters.</p> <p>Let’s see a code snippet, it is very easy to use <img class="wlEmoticon wlEmoticon-smile" style="border-top-style: none; border-bottom-style: none; border-right-style: none; border-left-style: none" alt="Smile" src="http://lh4.ggpht.com/-HQcb_i92FEQ/U4rJEenYfII/AAAAAAAABY4/_n3w8ICbnfU/wlEmoticon-smile2.png?imgmax=800"></p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:4cd40a9b-558f-4e97-b750-1424166ba5d7" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 450px; height: 329px;background-color:White;overflow: auto;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #000000;">Configuration InstallFX35_45<br />{<br />    </span><span style="color: #0000FF;">param</span><span style="color: #000000;">(</span><span style="color: #800080;">$servers</span><span style="color: #000000;">=</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">localhost</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">)<br />    Node </span><span style="color: #800080;">$servers</span><span style="color: #000000;"><br />    {<br />        WindowsFeature Net</span><span style="color: #000000;">-</span><span style="color: #000000;">Framework</span><span style="color: #000000;">-</span><span style="color: #000000;">Core<br />        {<br />            Ensure </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Present</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"><br />            Name </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Net-Framework-Core</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"><br />        }<br /><br />        WindowsFeature Net</span><span style="color: #000000;">-</span><span style="color: #000000;">Framework</span><span style="color: #000000;">-</span><span style="color: #000000;">45</span><span style="color: #000000;">-</span><span style="color: #000000;">Core<br />        {<br />            Ensure </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Present</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"><br />            Name </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Net-Framework-45-Core</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"><br />        }<br />    }<br />}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>Here it is. The Configuration block is called <strong>InstallFX35_45</strong> – it will check for the .NET Frameworks 3.5 and 4.5 on the target servers (or on just localhost if not specified) and, if any of them are not present at runtime, it would automatically trigger the installation of what’s missing via <strong>Install-WindowsFeature</strong>.</p><br /><p>We just have to launch it, to get the .mof file, and invoking <strong>Start-DscConfiguration</strong>:</p><br /><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:5f32474b-5c36-4c7e-90de-8c66008ad32d" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 542px; height: 32px;background-color:White;overflow: auto;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #000000;">InstallFX35_45 </span><span style="color: #000000;">-</span><span style="color: #000000;">servers </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">PTFSDT</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">PTFSAT</span><span style="color: #800000;">&quot;</span><span style="color: #000000;"><br />Start</span><span style="color: #000000;">-</span><span style="color: #000000;">DscConfiguration </span><span style="color: #000000;">-</span><span style="color: #000000;">Wait </span><span style="color: #000000;">-</span><span style="color: #000000;">Verbose </span><span style="color: #000000;">-</span><span style="color: #000000;">Path .\InstallFX35_45</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>Everything is <strong>handled by the OS</strong> – so what we should care about is the whole configuration, nothing else. This specific solution addresses almost all the needs we might face in a DevOps environment – and in a very robust way! </p><br /><p>DSC scripts are <strong>idempotent</strong> – so you can reapply a change and get to your desired state (hence the name…) regardless of the current status. No complex logic for catching exceptions or incremental changes – all is handled by the underlying infrastructure.</p><br /><p>You can use DSC for installing roles, services, interacting with IIS, copying files…all from PowerShell, and in a <strong>completely reproducible environment</strong>. </p><br /><p>The PowerShell team released a very handy <strong>Resource Kit</strong>, to get started with DSC and, eventually, DevOps – you can download it <a href="http://gallery.technet.microsoft.com/scriptcenter/DSC-Resource-Kit-All-c449312d">here</a>.</p><br /><p>&nbsp;</p><br /><p>.</p>  