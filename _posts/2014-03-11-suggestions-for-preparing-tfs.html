---
layout: post
title: Suggestions for preparing a TFS deployment with SQL AlwaysOn
date: '2014-03-11T10:27:00.001Z'
author: Matteo Emili
tags: 
modified_time: '2014-03-11T10:27:54.174Z'
thumbnail: http://lh5.ggpht.com/-5yR76FSJyag/Ux7lJHxyZ9I/AAAAAAAABT8/4sRMs4zdC1c/s72-c/SQLConfig15b_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-8909984247519895500
blogger_orig_url: https://mattvsts.blogspot.com/2014/03/suggestions-for-preparing-tfs.html
---

<p>SQL Server AlwaysOn is a utterly cool technology, but it is not a technology itself which solves all the problems you may have.</p> <p>In particular, it is not just about tweaking a couple of settings and adding servers as needed. A careful planning and thorough tests are mandatory in order to succeed without affecting the existing service or going overtime. So I wanted to sum up some tips I found during a project I am following with a huge deployment of Team Foundation Server 2013 which uses SQL Server AlwaysOn as an underlying High Availability solution.</p> <ol> <li><strong>Size your storage</strong><br>I am dealing with TBs of data, so I am experiencing that TBs of storage flies away in a snap. Do not underestimate your storage size and do not rely just on SANs. Importing your data takes time and space, especially if you restore your databases to the secondary replica using the <strong>Full</strong> mechanism of backup-and-restore provided by SQL Server AlwaysOn.<br><a href="http://lh6.ggpht.com/-oTmXs_M0x-I/Ux7lItkd0lI/AAAAAAAABT4/62zqsmJLoI8/s1600-h/SQLConfig15b2.png"><img title="SQLConfig15b" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="SQLConfig15b" src="http://lh5.ggpht.com/-5yR76FSJyag/Ux7lJHxyZ9I/AAAAAAAABT8/4sRMs4zdC1c/SQLConfig15b_thumb.png?imgmax=800" width="244" height="229"></a>  <li><strong>You can’t mix and match all the HA technologies<br></strong>Not all the SQL HA technologies are supported by TFS in the first place. <a href="http://msdn.microsoft.com/en-us/library/dd631889.aspx">MSDN</a> is pretty clear on this, <strong>no replication and no log shipping</strong>. Log shipping could <em>technically</em> work, but you won’t be supported by the Microsoft CSS, so it is a no no. You can mix a clustered SQL Server with another one in another location within the same AlwaysOn Availability Group though, and it is pretty robust. Keep in mind anyway that TFS is pretty agnostic about the underlying SQL deployment though, in fact the only feature which requires a specific configuration is AlwaysOn Availability Groups.  <li><strong>The MultiSubnetFailover setting<br></strong>When configuring Team Foundation Server for using AlwaysOn Availability Groups, remember to tick the specific checkbox about this setting. <strong>Beware </strong>of the setting: if you are not directly using an AG but you select it at TFS configuration time, you are going to be in trouble. If you are restoring it to a new server, launch TFSConfig RegisterDB to enable it:<br>&nbsp;&nbsp;&nbsp;&nbsp; <br>TFSConfig RegisterDB /SQLInstance:MyDB\namedinstanceifneeded /databaseName:Tfs_Configuration <strong>/usesqlalwayson</strong> <br><br><a href="http://lh5.ggpht.com/-lG-9nv9XdYc/Ux7lJoFYV5I/AAAAAAAABUE/zMebaAIaT_k/s1600-h/image2.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://lh6.ggpht.com/-roul0bBYrHE/Ux7lKDhzH2I/AAAAAAAABUM/z9AEDVxcGgs/image_thumb.png?imgmax=800" width="244" height="79"></a>&nbsp; <li><strong>All the Team Foundation Server databases must be in the AlwaysOn Availability Group<br></strong>No exceptions to this – if you use it, all the DBs must be contained in the AG.</li></ol>  