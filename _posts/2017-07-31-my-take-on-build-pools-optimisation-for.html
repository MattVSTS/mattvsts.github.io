---
layout: post
title: My take on build pools optimisation for the larger deployments
date: '2017-07-31T21:09:00.001+01:00'
author: Matteo Emili
tags: 
modified_time: '2017-07-31T21:09:02.214+01:00'
thumbnail: https://lh3.googleusercontent.com/-Ur71mdLmeS4/WX-OTpnX1RI/AAAAAAAAEhU/Uod9XawdSQs9Jbo1dnSIeR4mpUmw25PuwCHMYCw/s72-c/image_thumb?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-7373393133034091873
blogger_orig_url: https://mattvsts.blogspot.com/2017/07/my-take-on-build-pools-optimisation-for.html
---

<p>If you have a large pool of Build Agents it can be easy to incur in a terrible headache: plenty of hardware resources to handle, capabilities, pools, queues, etc.</p><p>Bearing this in mind, having a single <em>default </em>pool is the last thing you want IMHO:</p><p><a href="https://lh3.googleusercontent.com/-fHA4q1f-1C8/WX-OSlLNFDI/AAAAAAAAEhQ/yNuzLAflhm8-8AIUyRPTtbrcZfuh1p06wCHMYCw/s1600-h/image%255B2%255D"><img width="151" height="82" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Ur71mdLmeS4/WX-OTpnX1RI/AAAAAAAAEhU/Uod9XawdSQs9Jbo1dnSIeR4mpUmw25PuwCHMYCw/image_thumb?imgmax=800" border="0"></a></p><p>There are exceptions to this of course, like if you work on a single <em>system</em> (loosely defined, like a single product or a single suite of applications) or if you have a massive, horizontal team across the company. </p><p>Otherwise pulling all the resources together can be a bit of a nightmare, especially if company policy gets in the way – what if each development group/product team/etc. needs to provide hardware for their pools?</p><p>Breaking this down means you can create pools based on corporate organisation (build/division/team/whatever), on products (one pool per product or service) or on geography.</p><p>Performance should be taken into account in any case: you can add <strong>custom capabilities</strong> marking something special about your machines:</p><p><a href="https://lh3.googleusercontent.com/-jzcEVhwKYFg/WX-OUjWTbSI/AAAAAAAAEhY/2iHjfgPg6DEsU1BNlX2EHlxDj25hvGlvACHMYCw/s1600-h/image%255B5%255D"><img width="244" height="100" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Bo5qFFgO3EU/WX-OVjik5EI/AAAAAAAAEhc/MUf0VkVlAtM2wh_VKb8D2QkeQnwIwgwDQCHMYCw/image_thumb%255B1%255D?imgmax=800" border="0"></a></p><p>Do you need a CUDA-enabled build agent for some SDKs you are using? Add a capability. Is your codebase so legacy or massive that takes advantage of fast, NVMe SSDs? Add a capability. You get the gist of it after a while.</p><p>That becomes very nice, because with capabilities you can define your perfect build requirements when you trigger the build, and the system is going to choose the one that has all you need – saving you the hassle of manually finding what you need.</p><p>Maintaining these Build Agents is also important – that is why a <strong>Maintenance Job</strong> can be scheduled to clean up the _work folder in the agent:</p><p><a href="https://lh3.googleusercontent.com/-wP2fTsSSr8E/WX-OWb-jxqI/AAAAAAAAEhg/bPanKJywidgteopvtH7cy5RV4Xzo7rsjgCHMYCw/s1600-h/image%255B10%255D"><img width="504" height="259" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-4t28wXszKKk/WX-OXZOBC1I/AAAAAAAAEhk/6UHYXRGIUMotURWLO_kl6TEMK6BAfQOFQCHMYCw/image_thumb%255B4%255D?imgmax=800" border="0"></a></p><p>This can have an impact on your pools – that is why you can specify that only a certain percentage is going to undergo the job at once. Everything is also audited, in case you need to track down things going south.</p>