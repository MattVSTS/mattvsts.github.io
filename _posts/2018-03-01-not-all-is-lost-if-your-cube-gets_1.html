---
layout: post
title: Not all is lost if your cube gets corrupted…
date: '2018-03-01T15:47:00.001Z'
author: Matteo Emili
tags: 
modified_time: '2018-03-01T15:59:41.665Z'
thumbnail: https://lh3.googleusercontent.com/-ZZOMTSZBZsI/WpggXo3a8iI/AAAAAAAAE1s/_4NyDsvzMzUiIipe5ifxdeTXlQw1sL5dwCHMYCw/s72-c/image_thumb2_thumb?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-2314760369793623968
blogger_orig_url: https://mattvsts.blogspot.com/2018/03/not-all-is-lost-if-your-cube-gets_1.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">I ran into this very odd situation yesterday with the Reporting capability of my production TFS instance – I realised the Incremental Analysis Database Sync job and the Optimize Databases job were running for hours!<br /><br /><a href="https://lh3.googleusercontent.com/-tW3fVdhdkrw/WpggWu5c-0I/AAAAAAAAE1k/FG9wQhCAh9EE-g35pFdxGrhE3To9k2wwwCHMYCw/s1600-h/image_thumb2%255B2%255D"><img alt="image_thumb2" border="0" height="110" src="https://lh3.googleusercontent.com/-ZZOMTSZBZsI/WpggXo3a8iI/AAAAAAAAE1s/_4NyDsvzMzUiIipe5ifxdeTXlQw1sL5dwCHMYCw/image_thumb2_thumb?imgmax=800" style="background-image: none; border: 0px currentcolor; display: inline; margin: 0px;" title="image_thumb2" width="504" /></a><br /><br />I stopped the Incremental Analysis, and the Optimize Databases job completed successfully. Fine. <br />But – for whatever reason – my SSAS cube got corrupted! I couldn’t even connect to the Analysis Engine with SSMS. I also found errors in the Event Viewer pointing at a corrupted cube:<br /><br /><a href="https://lh3.googleusercontent.com/-I6FMsvyItWk/WpggY1aimtI/AAAAAAAAE1w/p1xgG9tBU5YnVSFttzkJA5bmpCHXPuTOgCHMYCw/s1600-h/image_thumb1%255B2%255D"><img alt="image_thumb1" border="0" height="163" src="https://lh3.googleusercontent.com/-cwc91A2EaJ8/WpggaDBm5fI/AAAAAAAAE10/fDzk24pxpikNhZYH68MFWIRLL-BoTJCIACHMYCw/image_thumb1_thumb?imgmax=800" style="background-image: none; border: 0px currentcolor; display: inline; margin: 0px;" title="image_thumb1" width="453" /></a><br /><br /><strong>Errors in the metadata manager. An error occurred when loading the 'Team System' cube, from the file, '\\?\&lt;path&gt;\Tfs_Analysis.0.db\Team System.3330.cub.xml'.</strong><br /><strong>Errors in the metadata manager. An error occurred when loading the 'Test Configuration' dimension, from the file, '\\?\&lt;path&gt;\Tfs_Analysis.0.db\Configuration.254.dim.xml'.</strong><br /><strong><br /></strong>Now, what to do? It looked like a full-blown <a href="https://docs.microsoft.com/en-us/vsts/report/admin/rebuild-data-warehouse-and-cube">rebuild</a> was in order, and it is a costly operation, given that what the rebuild does is dropping both the data warehouse and the SSAS cube, rebuilds the warehouse with data from the TFS databases and then rebuilds the cube. <br /><br />It is not like being without source code or Work Items, but still… it is an outage, and it is painful to swallow.<br /><br />Now, in this case the data warehouse was perfectly healthy – the report shown an update age just a few minutes old. So all the raw data in this case is fine, and all you need to do is to rebuild how you <em>look</em> at this data.<br /><br />The SSAS cube is just <em>a way of looking at</em> the data warehouse. If your warehouse is fine, just wait for the next scheduled Incremental Analysis Database Sync job to run, it will recreate the cube (thus making the Analysis Database Sync job a Full one rather than an Incremental one) without going through the full rebuild.<br /><br /><a href="https://lh3.googleusercontent.com/-Url8Yr1Fc6E/Wpgga4dNvrI/AAAAAAAAE14/6idHIBYIrJ4pdDcIW_yl4MjQsAYRce5OACHMYCw/s1600-h/clip_image0025_thumb1%255B2%255D"><img alt="clip_image0025_thumb1" border="0" height="94" src="https://lh3.googleusercontent.com/-bRSWWnbW77w/Wpggbw6abQI/AAAAAAAAE18/E55g-_tKsDQmlvY32Zr-gEAZNU2zJwbxQCHMYCw/clip_image0025_thumb1_thumb?imgmax=800" style="background-image: none; border: 0px currentcolor; display: inline;" title="clip_image0025_thumb1" width="504" /></a><br /><br />Why didn’t I process this myself by using the WarehouseControlService? Simply because the less you mess with the scheduled jobs the better it is <img alt="Smile" class="wlEmoticon wlEmoticon-smile" src="https://lh3.googleusercontent.com/-rT1mTrOwZCM/WpggdJFpw1I/AAAAAAAAE2A/nYRwXyyWbDcvOChRrNqkmkU2V6ulH_ZlgCHMYCw/wlEmoticon-smile%255B2%255D?imgmax=800" />hiccups happen, but the system is robust enough to withstand such problems and pretty much self-heal itself once the stumbling block is removed.</div>