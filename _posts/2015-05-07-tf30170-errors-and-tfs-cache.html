---
layout: post
title: TF30170 errors and the TFS Cache
date: '2015-05-07T11:36:00.001+01:00'
author: Matteo Emili
tags: 
modified_time: '2015-05-07T11:36:28.122+01:00'
thumbnail: http://lh3.googleusercontent.com/-gaO9lvrbBvE/VUtAKoDwY-I/AAAAAAAAB-Q/n-IUNIY3vZI/s72-c/0_thumb%25255B1%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-7239574674430956743
blogger_orig_url: https://mattvsts.blogspot.com/2015/05/tf30170-errors-and-tfs-cache.html
---

<p>Weird things happen, like this:</p> <p><a href="http://lh3.googleusercontent.com/-RhY43PGdqZ0/VUtAJ-KRXJI/AAAAAAAAB-M/4pLrVtfDMTE/s1600-h/0%25255B3%25255D.png"><img title="0" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="0" src="http://lh3.googleusercontent.com/-gaO9lvrbBvE/VUtAKoDwY-I/AAAAAAAAB-Q/n-IUNIY3vZI/0_thumb%25255B1%25255D.png?imgmax=800" width="597" height="484"></a> </p> <p>“<em>An item with the same key has already been added.</em>” <strong>How?!</strong></p> <p>Nothing catastrophic actually – it is just a matter of clearing the cache. This happened because this instance of Team Foundation Server was restored as part of a Disaster Recovery exercise, and its ID was <a href="http://mattvsts.blogspot.co.uk/2013/11/how-to-change-tfs-guid-and-why-is-it.html">not changed</a>.</p> <p>So, in order to solve this (and other similar <strong>TF30170</strong> errors) just look at the logs – if you find that explanation message in one of the exceptions, or similar (like “<em>cannot add LinkTypes relationship”</em>) then I would suggest to clear the Team Foundation Cache:</p> <p><strong>&lt;OSDrive&gt;:\Users\&lt;youruser&gt;\AppData\Local\Microsoft\Team Foundation\</strong></p> <p>There are some folders in there, each containing a <strong>Cache</strong> folder. Empty those Cache folders, and try again. If there is nothing actually wrong underneath the Team Project would be created without problems.</p> <p></p> <p>A couple of remarks: it happens that the Team Project would be actually allocated on your target server even if the creation fails (it won’t be accessible and it is shown as <strong><em>Deleting</em></strong>). In this scenario it is pretty common that Visual Studio launches part of the temporary Team Project deletion but it would fail because it is not pointing at the right server GUID – open the TFS Admin Console and relaunch a <strong>manual</strong> deletion on the temporary Team Project.</p> <p>Eventually, this might happen because you are not <a href="http://mattvsts.blogspot.co.uk/2014/08/tfs-transaction-marking-on-sql-server.html">marking</a> your Transaction Logs backups, so you restored some of the database out of the right order. Please use the TFS Backup Tool, or if you can’t, mark the transactions so you won’t hit that again.</p>  