---
layout: post
title: Recycle your PowerShell scripts in a custom Azure DevOps task
date: '2018-12-28T11:28:00.002Z'
author: Matteo Emili
tags: 
modified_time: '2018-12-28T11:28:37.209Z'
thumbnail: https://3.bp.blogspot.com/-ZbdduTzTmh0/XCYGAXKmdcI/AAAAAAAAFPY/hfZPlN1CqZAjuQA35R-rAqdLJ10tVDqqwCLcBGAs/s72-c/tfxcli0.png
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-4140818738373392394
blogger_orig_url: https://mattvsts.blogspot.com/2018/12/recycle-your-powershell-scripts-in.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">I am a huge PowerShell fan, and pretty much anybody who knows me is aware of that.<br /><br />Over time I developed my set of scripts for demos and conferences, and some of them are in use in my homelab on a regular basis. One of them is for managing Azure Traffic Manager, and I realised that there is no Azure DevOps task for managing Traffic Manager on the marketplace! Thanks to the brilliant session Utkarsh did at the London Microsoft DevOps Meetup I decided to give a go at at converting that script.<br /><br />So this is what I did to recycle my script in a task - beware: this post is a crash course on how to do that, and I don't think it is actually anything special. It is just an easy way of productively recycle some existing scripts in a good way. I haven't finished yet - as a good Product Owner I started with an MVP and I see there is more and more to add to it ðŸ‘€ - but it is slowly coming together and I hope it can be useful to someone in the near future.<br /><br />What you need to do is create the scaffolding with the tfx cli. from which you can start customising the script.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-ZbdduTzTmh0/XCYGAXKmdcI/AAAAAAAAFPY/hfZPlN1CqZAjuQA35R-rAqdLJ10tVDqqwCLcBGAs/s1600/tfxcli0.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="183" data-original-width="651" height="111" src="https://3.bp.blogspot.com/-ZbdduTzTmh0/XCYGAXKmdcI/AAAAAAAAFPY/hfZPlN1CqZAjuQA35R-rAqdLJ10tVDqqwCLcBGAs/s400/tfxcli0.png" width="400" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br />Then remove any reference to the JavaScript portion of the task - you are just recycling a PowerShell script so you don't need it! It will also save you time when debugging it as otherwise the runner defaults to the JavaScript entry-point. Needless to say, the name of the target script is going to be the name of your script.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-Cj5fouoj_6I/XCYHHNU2MyI/AAAAAAAAFPg/zATde-wZqkYbQ5molLX9SS3eGaOU-BZhgCLcBGAs/s1600/tfxcli1.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="133" data-original-width="359" src="https://3.bp.blogspot.com/-Cj5fouoj_6I/XCYHHNU2MyI/AAAAAAAAFPg/zATde-wZqkYbQ5molLX9SS3eGaOU-BZhgCLcBGAs/s1600/tfxcli1.png" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />Add the <a href="https://www.powershellgallery.com/packages/VstsTaskSdk/0.9.0">VstsTaskSdk </a>module otherwise you are going to get odd errors out. Also, remove any versioning reference. The structure should be <b>.../ps_modules/VstsTaskSdk</b>. This is true for every module you are going to use:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-sUfRIRvoW-4/XCYHd1k_oTI/AAAAAAAAFPo/1kNLgSrOVIMgCHvVzCYtK0Fp11HP7M6cACLcBGAs/s1600/tfxcli2.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="110" data-original-width="214" src="https://4.bp.blogspot.com/-sUfRIRvoW-4/XCYHd1k_oTI/AAAAAAAAFPo/1kNLgSrOVIMgCHvVzCYtK0Fp11HP7M6cACLcBGAs/s1600/tfxcli2.png" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br />Code-wise, keep the scaffolding as clean as you can, and add your script inside the try statement after the Trace-VstsEnteringInvocation $MyInvocation. You should be able to recycle your script with little changes, of course some adjustment might be needed. If you need to get input parameters you can use the Get-VstsInput command.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-OK20nMbZ1yo/XCYIYboCJuI/AAAAAAAAFPw/SlYiTeK6mNke8c7QFvAlo_4BLoC_g2jpQCLcBGAs/s1600/tfxcli3.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="292" data-original-width="646" height="180" src="https://1.bp.blogspot.com/-OK20nMbZ1yo/XCYIYboCJuI/AAAAAAAAFPw/SlYiTeK6mNke8c7QFvAlo_4BLoC_g2jpQCLcBGAs/s400/tfxcli3.png" width="400" /></a></div><br /><br /><br /></div>