---
layout: post
title: Pre-upgrading a large Team Project Collection to TFS 2015
date: '2015-08-13T11:57:00.001+01:00'
author: Matteo Emili
tags: 
modified_time: '2015-08-13T11:57:59.168+01:00'
thumbnail: http://lh3.googleusercontent.com/-iaJzQKJJo8c/Vcx4J2idGII/AAAAAAAACOE/aePEQ5djU9U/s72-c/image_thumb2.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-8936326952324662912
blogger_orig_url: https://mattvsts.blogspot.com/2015/08/pre-upgrading-large-team-project.html
---

<p>TFS 2015 is out and we all rush upgrading our Team Project Collections!</p> <p>But if you have a collection bigger than 1TB you should stand back and read some documentation before that. <a href="https://msdn.microsoft.com/Library/vs/alm/TFS/upgrade/pre-upgrade">This page</a> in particular explains what you should do if you want to upgrade such a huge collection.</p> <p>The reason for using TfsPreUpgrade is very simple – you don’t want your users stuck for days while you upgrade Team Foundation Server. So the tool is going to partially upgrade the schema while the server is still available, so the actual upgrade (the one done by the installer) takes no longer than two days, which means a weekend, which also means <strong>no perceivable service interruptions</strong>.</p> <p>You can run TfsPreUpgrade from whatever machine you like. In my testing environment I am using at the moment I am running it from a plain Virtual Machine which is going to be used by the Application Tier, but it has nothing installed yet. You basically need <strong>access to SQL Server</strong>, and that’s it.</p> <p>First thing, run it with the <strong>Estimate</strong> switch. It will give you an idea of the time and space needed for the upgrade:</p> <p><a href="http://lh3.googleusercontent.com/-aOak5xbb1Yc/Vcx4I6pmfII/AAAAAAAACN4/lyosDC4stDQ/s1600-h/image4.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://lh3.googleusercontent.com/-iaJzQKJJo8c/Vcx4J2idGII/AAAAAAAACOE/aePEQ5djU9U/image_thumb2.png?imgmax=800" width="584" height="206"></a> </p> <p>To give some context, this is data for a 2TB Collection. A few hiccups while running the <strong>Run </strong>switch might happen, especially with a temporary test environment:</p> <p><a href="http://lh3.googleusercontent.com/-BiKP5o78_LQ/Vcx4KhIciPI/AAAAAAAACOQ/2qrQOOYtzjc/s1600-h/image5.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://lh3.googleusercontent.com/-EDrWWXFfJ_4/Vcx4Lll9OuI/AAAAAAAACOc/MFWFLhdRU54/image_thumb2%25255B1%25255D.png?imgmax=800" width="584" height="125"></a> </p> <p></p> <p>but you can just relaunch TfsPreUpgrade and it would start again from the same failed point after a quick check. It is smart enough to not further expand your databases if you don’t need it:</p> <p><a href="http://lh3.googleusercontent.com/-HvFQxObygfw/Vcx4MWb_AbI/AAAAAAAACOo/RhLygMcGKw0/s1600-h/image10.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://lh3.googleusercontent.com/-L-tBgGH_MKw/Vcx4NZuoKyI/AAAAAAAACO0/SwP9P5jUQ0M/image_thumb5.png?imgmax=800" width="584" height="252"></a></p> <p>Once it is done your offline upgrade will be much faster, because these operations were carried in advance!</p>  