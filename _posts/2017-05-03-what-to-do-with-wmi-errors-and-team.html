---
layout: post
title: What to do with WMI errors and Team Foundation Server
date: '2017-05-03T10:08:00.000+01:00'
author: Matteo Emili
tags: 
modified_time: '2017-05-03T10:08:54.904+01:00'
thumbnail: https://4.bp.blogspot.com/-fn4RZzSAb5U/WQmWoaEKoMI/AAAAAAAAEcc/9nA26a5w4TY7RD4Dxgpe-6fCCxmWHCk5QCPcB/s72-c/wmi2.png
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-722921547005678813
blogger_orig_url: https://mattvsts.blogspot.com/2017/05/what-to-do-with-wmi-errors-and-team.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">Last week I spent some time on trying to sort out WMI errors in a test environment. That was not fun, but at the end of the day there is something to learn out of it.<br /><div dir="ltr" style="text-align: left;" trbidi="on">Everything starts with this set of errors with an AT-only installation:</div><div dir="ltr" style="text-align: left;" trbidi="on"></div><div dir="ltr" style="text-align: left;" trbidi="on"><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-fn4RZzSAb5U/WQmWoaEKoMI/AAAAAAAAEcc/9nA26a5w4TY7RD4Dxgpe-6fCCxmWHCk5QCPcB/s1600/wmi2.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="122" src="https://4.bp.blogspot.com/-fn4RZzSAb5U/WQmWoaEKoMI/AAAAAAAAEcc/9nA26a5w4TY7RD4Dxgpe-6fCCxmWHCk5QCPcB/s400/wmi2.png" width="400" /></a></div><br /></div><div dir="ltr" style="text-align: left;" trbidi="on"><br /><br /><br /><br /><br /><br /><br /><br />Looking at the logs you can see it is pretty bad stuff:<br /><br /></div><div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-yYffpMmNE3U/WQmWoJ93w5I/AAAAAAAAEcc/0MpB4BqlviEYEfMKJmj4HKCZaxZKcZREwCPcB/s1600/wmi0.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="62" src="https://4.bp.blogspot.com/-yYffpMmNE3U/WQmWoJ93w5I/AAAAAAAAEcc/0MpB4BqlviEYEfMKJmj4HKCZaxZKcZREwCPcB/s400/wmi0.PNG" width="400" /></a></div><br /><br /><br /><br /><br /><br /><br />I tried with the usual suspects (<strong>wmimgmt /verifyrepository</strong>, setting the involved machines as standalone hosts, etc), but they all run fine. One of the suggestions you can find around is to reinstall the IIS 6 Management Tools on the Application Tier:</div><div dir="ltr" style="text-align: left;" trbidi="on"><br /></div><div dir="ltr" style="text-align: left;" trbidi="on"><a href="https://4.bp.blogspot.com/-DeRNdSWVA7c/WQmWoKM91-I/AAAAAAAAEcc/JlP1eHIc20Y8qB3fzAuz6l08SCRgjD3iACPcB/s1600/wmi1.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-DeRNdSWVA7c/WQmWoKM91-I/AAAAAAAAEcc/JlP1eHIc20Y8qB3fzAuz6l08SCRgjD3iACPcB/s1600/wmi1.PNG" /></a><br /><br /><br /><br /><br /><br /><br />Still no luck. I tried connecting with <strong>wmimgmt.msc</strong> and I got all sorts of errors. At the end of the day I temporarily reset the WMI repository on that machine and I then decided to move these test services to another VM. Why?<br /><br /></div><div dir="ltr" style="text-align: left;" trbidi="on"></div><div dir="ltr" style="text-align: left;" trbidi="on">The WMI repository is not supposed to be rebuilt lightly. It should be the last resort, and I did not want to tie up this testing environment with a potentially problematic machine.</div><div dir="ltr" style="text-align: left;" trbidi="on">Don’t forget that the Application Tier is <em>just</em> a front-end for Team Foundation Server. You can replace it with another machine and scale out as needed. <br /><br /></div><div dir="ltr" style="text-align: left;" trbidi="on"></div><div dir="ltr" style="text-align: left;" trbidi="on">Also, the errors above appear in both the Application Tier and Data Tier readiness check category for the AT-only install, despite they only apply to the AT. That is because the machine could not communicate with anything beyond itself (not even itself I would add), so it would report that the Data Tier isn’t reachable. Do not touch the database servers unless you really have to, and the <strong>logs </strong>are going to tell you if you have.</div></div>