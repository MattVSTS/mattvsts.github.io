---
layout: post
title: TFS Audits – how to create reports on your TFS usage in five minutes or so…
date: '2014-07-07T16:12:00.001+01:00'
author: Matteo Emili
tags: 
modified_time: '2014-07-07T16:12:16.325+01:00'
thumbnail: http://lh6.ggpht.com/-gBW99-o1NY8/U7q4qxsEv9I/AAAAAAAABfc/CpXBBVh4xxE/s72-c/image_thumb%25255B1%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-8973438168929120771
blogger_orig_url: https://mattvsts.blogspot.com/2014/07/tfs-audits-how-to-create-reports-on.html
---

<p>Some months ago I wrote about the <a href="http://mattvsts.blogspot.co.uk/2014/03/how-to-perform-tfs-security-audit.html">TFS Audit Log</a>, because a big part of my daily job is about governance, regulation and access management.</p> <p>This log is very, very, <strong>very verbose</strong> as it is a flat list of every single user and group into the Team Foundation Server’s ACLs. How to get some more meaningful information from it?</p> <p>The basic <strong>Sort functions</strong>, together with the <strong>Text to Columns</strong> of Excel are a must in order to format it in the best possible way. You can then create a PivotTable and mix/match your data and the criteria you want to show:</p> <p><a href="http://lh6.ggpht.com/-aQoUNuq4xYg/U7q4qODHJII/AAAAAAAABfY/V_I-DnguNu4/s1600-h/image%25255B1%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="http://lh6.ggpht.com/-gBW99-o1NY8/U7q4qxsEv9I/AAAAAAAABfc/CpXBBVh4xxE/image_thumb%25255B1%25255D.png?imgmax=800" width="351" height="484"></a>&nbsp; This fairly basic PivotTable is going to give you this result: <a href="http://lh5.ggpht.com/-MzXtFsTOH-E/U7q4rO5K_RI/AAAAAAAABfk/Q7XHfL_Obo8/s1600-h/image5.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="http://lh3.ggpht.com/-tYEYpdXMPBk/U7q4rwMpjSI/AAAAAAAABfw/xfosU15Oyac/image_thumb1.png?imgmax=800" width="244" height="107"></a> </p> <p>It is basic, but it is something you can do in zero time. Add a chart to the mix and you have a nice (reusable, as you just need to replace the datasource, which is the whole original Audit Log. So in case you need to do it monthly you just need to replace the appropriate sheet and you’re done) report for understanding the ratio between users and group, without the need of complex SSRS reports or even PowerPivot.</p> <p>Then for instance…if I want to get a text document with all the users contained in each TFS group, the only command I need to launch is <strong>tfssecurity /imx</strong>. As I have hundreds of groups it is quite…long for a manual interaction. So, I’d create a text file with all the groups - copy, paste from the original audit log, one for each line – and then launch the following command from the Visual Studio Command Prompt:</p> <p><strong>for /f "tokens=* delims=," %l in (&lt;path to groups.txt&gt;) do tfssecurity /imx "%l" /server:</strong><a href="http://&lt;tfs"><strong>http://&lt;tfs</strong></a><strong>&gt;:8080 &gt;&gt; &lt;path to mygroupaudit.txt&gt;</strong></p> <p>this simple command is going to execute tfssecurity /imx for each group and, thanks to the &gt;&gt; sign it is going to append the tfssecurity’s output to the mygroupaudit.txt file. I usually launch it on an unattended machine and keep it running on the background until it finishes.</p> <p></p> <p>Then in order to get a basic but polished report, open the resulting file in Word, and change the font setting to <strong>Bold</strong> for these four lines, except for the very first on top which are IMHO useful for a nice presentation:</p> <p><b>Done.<br></b><b>Microsoft (R) TFSSecurity - Team Foundation Server Security Tool<br></b><b>Copyright (c) Microsoft Corporation. All rights reserved.<br></b><b>The target Team Foundation Server is <a href="http://&lt;tfs&gt;:8080/">http://&lt;tfs&gt;:8080/</a>.</b></p> <p>Word has a very useful feature for this needs: <strong>select text with similar formatting</strong>. Do that and wipe those lines away! You’ll get something neat and polished – change fonts, and add whatever else you need and you’ll get an Audit Report in five minutes :)</p> <p>Of course it’s possible to use that file in a better way, but these basic tips will give you <em>something</em> in a near-to-none time!</p> <p>Going slightly deeper in the reporting technologies – PowerPivot is perfect for that. You just need to load the .csv file and you have a dynamic model perfect for drill-down queries. With this:</p> <p><a href="http://lh4.ggpht.com/-oVneKHIMOwk/U7q4sRYwvJI/AAAAAAAABf0/IV7roQ_F2nI/s1600-h/image%25255B4%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="http://lh5.ggpht.com/-oxvRHpBPoV0/U7q4tDiSPHI/AAAAAAAABgA/h13x2_g_GBw/image_thumb%25255B2%25255D.png?imgmax=800" width="244" height="137"></a> you’re going to get this chart: <a href="http://lh3.ggpht.com/-TlyzGKcaAwY/U7q4tuCWQHI/AAAAAAAABgI/7QB7mwEubW8/s1600-h/image%25255B18%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="http://lh5.ggpht.com/-1i9bmglt7sw/U7q4uA5mWOI/AAAAAAAABgQ/gUH9YqkYaUk/image_thumb%25255B14%25255D.png?imgmax=800" width="550" height="345"></a> </p> <p>which is pretty basic. But what if you want to know how many users with <strong>Full Access </strong>(which require a CAL as we know) accessed the server on a specific date…well, you can create a chart having <strong>Last Accessed UTC</strong> on the Axis as well as on a <strong>Slicer</strong>, so you can filter your timeframe – and <strong>Sum of Full</strong> on the Values:</p> <p><a href="http://lh4.ggpht.com/-ua3gTuCxJBE/U7q4u9iaoMI/AAAAAAAABgY/CYQwsu0oj0o/s1600-h/image%25255B23%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="http://lh5.ggpht.com/-JRf1ROAZ8i0/U7q4vuKYSVI/AAAAAAAABgg/ZUvhm3MyIwM/image_thumb%25255B17%25255D.png?imgmax=800" width="644" height="272"></a> </p> <p>But as it is PowerPivot, you can drill down as you wish…so if from my dates selection I select just today at 13:09 (where this is the only access for today on this test instance, by me) and I drill down by Display Name what I get is …</p> <p><a href="http://lh3.ggpht.com/-5UtBmBAN4Lg/U7q4wOW4j1I/AAAAAAAABgo/-tXT4JFH0_c/s1600-h/image%25255B39%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="http://lh5.ggpht.com/-DXLAESZiJI0/U7q4w7RbN6I/AAAAAAAABgs/TxRkbqGjNdc/image_thumb%25255B27%25255D.png?imgmax=800" width="644" height="234"></a> </p> <p>…a big pie with just me as a value:</p> <p><a href="http://lh4.ggpht.com/-kwmh3zvN0jk/U7q4xRl0GeI/AAAAAAAABg0/QhKDqeZlYA0/s1600-h/image%25255B44%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="http://lh6.ggpht.com/-mKHVZ5ivJy4/U7q4yKGf7HI/AAAAAAAABhA/vro28MHtEng/image_thumb%25255B30%25255D.png?imgmax=800" width="644" height="203"></a> </p> <p>These are just easy samples, but as soon as you get that this csv data is a data source…the whole reporting world will welcome you!</p>  