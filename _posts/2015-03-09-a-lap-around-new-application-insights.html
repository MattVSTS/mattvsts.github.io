---
layout: post
title: A lap around the new Application Insights
date: '2015-03-09T16:21:00.001Z'
author: Matteo Emili
tags: 
modified_time: '2015-03-09T16:21:34.425Z'
thumbnail: http://lh4.ggpht.com/-2O6fBZI5mqo/VP3ILW2B6jI/AAAAAAAAB04/JfXhFGL8c-o/s72-c/0_thumb%25255B1%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-4525916596323518524
blogger_orig_url: https://mattvsts.blogspot.com/2015/03/a-lap-around-new-application-insights.html
---

<p>I really like Application Insights – it is no mystery, just look at how many posts I wrote on it – and the last time I purposely <a href="http://mattvsts.blogspot.co.uk/2014/09/application-insights-whats-going-on.html">played with it</a> was around 2013.3 last September, with the 2.0 version approaching the release and a complete under the hood rewrite to fit into Microsoft Azure.</p> <p>Well, <strong>a lot </strong>changed in the last six months…let’s start from scratch: we have a Web Site running, we want to add Application Insights as the production monitoring solution. </p> <p><a href="http://lh6.ggpht.com/-KKD2GUOXtpg/VP3IK8v5H5I/AAAAAAAAB0w/NxnSMzW65VI/s1600-h/0%25255B3%25255D.png"><img title="0" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="0" src="http://lh4.ggpht.com/-2O6fBZI5mqo/VP3ILW2B6jI/AAAAAAAAB04/JfXhFGL8c-o/0_thumb%25255B1%25255D.png?imgmax=800" width="480" height="484"></a></p> <p>You are running on Azure, so the <strong>request monitoring</strong> is implemented out-of-the-box. No configuration, no code changes – it is offered <strong>as part of the Azure</strong> <strong>infrastructure</strong>. If we want to monitor the actual end-user usage, we need to add a bit of <strong>JavaScript</strong> to your pages:</p> <p>&nbsp;<a href="http://lh3.ggpht.com/-WMLAqv6fIH4/VP3IL7e6lSI/AAAAAAAAB1A/KkPm4maeKYE/s1600-h/1%25255B3%25255D.png"><img title="1" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="1" src="http://lh3.ggpht.com/-B7IaBGsnxlQ/VP3IMb8US1I/AAAAAAAAB1E/MkToSWrwQY0/1_thumb%25255B1%25255D.png?imgmax=800" width="548" height="484"></a> </p> <p>Doing this will enable the<strong> usage monitoring</strong>. You are going to notice how fast and sleek Application Insights is now compared to the old Visual Studio Online implementation, it is a matter of a <strong>couple of minutes</strong> at worst and you are going to look at your freshly fetched data:</p> <p><a href="http://lh3.ggpht.com/-R1E2w8W9l6U/VP3IM6aOnvI/AAAAAAAAB1M/zampU4AgPJY/s1600-h/2%25255B7%25255D.png"><img title="2" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="2" src="http://lh4.ggpht.com/-tKTzVgxb7k0/VP3INeoZTwI/AAAAAAAAB1U/0-Z4CvWUxcU/2_thumb%25255B5%25255D.png?imgmax=800" width="190" height="366"></a></p> <p>Obviously you can <strong>dig into</strong> this data – it is a monitoring platform after all!</p> <p>&nbsp;<a href="http://lh6.ggpht.com/-MvhS2Of5k0w/VP3INpa-4EI/AAAAAAAAB1g/XMCQjDH_EeA/s1600-h/3%25255B7%25255D.png"><img title="3" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="3" src="http://lh5.ggpht.com/-v4oZeCGaSvA/VP3IOV8e6gI/AAAAAAAAB1o/feu4J_aB8pI/3_thumb%25255B5%25255D.png?imgmax=800" width="313" height="484"></a> <a href="http://lh3.ggpht.com/-qOYvNbV4NIo/VP3IOlzPQcI/AAAAAAAAB1s/A6sYGk5JPIk/s1600-h/4%25255B3%25255D.png"><img title="4" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="4" src="http://lh4.ggpht.com/-LGOWwvqfwBo/VP3IPBR2RAI/AAAAAAAAB10/NXgXc6TGKxw/4_thumb%25255B1%25255D.png?imgmax=800" width="541" height="484"></a> </p> <p>The <strong>Diagnostic search</strong> is very cool because it is a <strong>pre-filtered, context-based</strong> series of charting which enables troubleshooting and diagnostic scenarios with a couple of clicks. For instance here I can access the details of a page’s status in a certain session:</p> <p><a href="http://lh3.ggpht.com/-WYKmdW50GAQ/VP3IPgS_ynI/AAAAAAAAB18/ASfMAspcCvE/s1600-h/5%25255B3%25255D.png"><img title="5" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="5" src="http://lh4.ggpht.com/-7W9hwJaHY-U/VP3IQC_yxoI/AAAAAAAAB2E/9SZ1M-Hb8R8/5_thumb%25255B1%25255D.png?imgmax=800" width="387" height="484"></a> <a href="http://lh3.ggpht.com/-xulnFk4Kfp0/VP3IQn_ThuI/AAAAAAAAB2M/2ENlOqKVMdE/s1600-h/6%25255B3%25255D.png"><img title="6" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="6" src="http://lh4.ggpht.com/-N5U9wJqMq3g/VP3IQzD7YPI/AAAAAAAAB2U/j0EpYJQaYJQ/6_thumb%25255B1%25255D.png?imgmax=800" width="320" height="484"></a> </p> <p>subsequently, I might want to see the <strong>telemetry</strong> for the whole session:</p> <p><a href="http://lh6.ggpht.com/-hQVqX-r0VYM/VP3IRVD3JEI/AAAAAAAAB2c/S9iXZV38qTs/s1600-h/7%25255B3%25255D.png"><img title="7" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="7" src="http://lh6.ggpht.com/-fdXchlPm6eQ/VP3IRq_C3lI/AAAAAAAAB2k/Xgn346WGb2w/7_thumb%25255B1%25255D.png?imgmax=800" width="644" height="255"></a> </p> <p>so looking at what this user did, in case I am inspecting a suspect behaviour on a bug report:</p> <p><a href="http://lh4.ggpht.com/-OALtItltJoQ/VP3ISJhK91I/AAAAAAAAB2s/CSr7O-LAVCU/s1600-h/8%25255B8%25255D.png"><img title="8" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="8" src="http://lh4.ggpht.com/-c79MEYBzF_Q/VP3IS_n7ysI/AAAAAAAAB24/Yy2z0IPlOa0/8_thumb%25255B6%25255D.png?imgmax=800" width="471" height="772"></a> </p> <p>The other option is on a timeframe, so looking at the <strong>ten minutes interval around the event</strong> I scoped my search on:</p> <p><a href="http://lh3.ggpht.com/-dxu4djX-j2k/VP3ITeuoM1I/AAAAAAAAB28/H7inPBmhEBE/s1600-h/9%25255B3%25255D.png"><img title="9" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="9" src="http://lh4.ggpht.com/-ex4QHRIcUCs/VP3ITm9sWVI/AAAAAAAAB3E/NwIBtY-5zUE/9_thumb%25255B1%25255D.png?imgmax=800" width="644" height="266"></a>&nbsp; </p> <p>Moving on to the health and performance monitoring, you need the <strong>Application Insights Telemetry</strong>, a two-click operation in Visual Studio which is going to lead to a new <strong>NuGet package</strong> installed in my solution:</p> <p>&nbsp;<a href="http://lh3.ggpht.com/-2m3bx8QnbSw/VP3IUbQUvXI/AAAAAAAAB3Q/iGKkrDbF6t4/s1600-h/14%25255B3%25255D.png"><img title="14" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="14" src="http://lh6.ggpht.com/-_F6qoHYwfAM/VP3IVK4kSgI/AAAAAAAAB3U/RbvFYc2YPVY/14_thumb%25255B1%25255D.png?imgmax=800" width="539" height="484"></a>&nbsp; </p> <p><a href="http://lh5.ggpht.com/-twhE-8cupUs/VP3IVjRJurI/AAAAAAAAB3c/SIHVpp8PiuM/s1600-h/15%25255B7%25255D.png"><img title="15" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="15" src="http://lh5.ggpht.com/-SpWWbxCllMs/VP3IWBn7QoI/AAAAAAAAB3k/8QxCR-cS4Nk/15_thumb%25255B5%25255D.png?imgmax=800" width="535" height="565"></a></p> <p>So I can enabled scenarios like this - I have a troublesome page here:</p> <p><a href="http://lh4.ggpht.com/-lPagOo2XvEM/VP3IWVsBHUI/AAAAAAAAB3s/KedYFPg8PTY/s1600-h/11%25255B3%25255D.png"><img title="11" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="11" src="http://lh3.ggpht.com/-1e2NEPMmcGw/VP3IW8oCpDI/AAAAAAAAB30/Wgq5ubivFOI/11_thumb%25255B1%25255D.png?imgmax=800" width="644" height="186"></a></p> <p>I can dig into the Metrics Explorer, and look at the stats – each event is reportable and will boast a number of properties you can use to investigate.</p> <p>&nbsp;<a href="http://lh6.ggpht.com/-hZo9amFUSJY/VP3IXTDPbrI/AAAAAAAAB38/BgeXfLEiUac/s1600-h/12%25255B3%25255D.png"><img title="12" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="12" src="http://lh3.ggpht.com/-8iMUEHXGx6A/VP3IXjrXcSI/AAAAAAAAB4I/p4C65RA_gZQ/12_thumb%25255B1%25255D.png?imgmax=800" width="644" height="467"></a></p> <p>&nbsp;</p> <p>If you want to log custom events, it is a matter of using the same <strong>appInsights</strong> object created by the existing snippet and model what you need to log. For example, I might want to log an event with two properties, a string and an integer:</p> <p>&nbsp;<a href="http://lh6.ggpht.com/-4rzDAQl4Fvk/VP3IYLFIPUI/AAAAAAAAB4M/U5gKTj5d8Kc/s1600-h/17%25255B3%25255D.png"><img title="17" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="17" src="http://lh3.ggpht.com/-PkDp_8Fh9pE/VP3IYmmnS5I/AAAAAAAAB4U/osDpiQbusBg/17_thumb%25255B1%25255D.png?imgmax=800" width="602" height="26"></a> </p> <p>and out-of-the-box I would get support for <strong>sorting and aggregating</strong> my custom properties in the charts:</p> <p><a href="http://lh6.ggpht.com/-sQY7H3ScFtg/VP3IY65153I/AAAAAAAAB4c/NUef2pYmvUU/s1600-h/18%25255B3%25255D.png"><img title="18" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="18" src="http://lh3.ggpht.com/-b9vZQUYlJeQ/VP3IZauksvI/AAAAAAAAB4k/xjTpSapEjQU/18_thumb%25255B1%25255D.png?imgmax=800" width="290" height="72"></a> <a href="http://lh5.ggpht.com/-ddeHBjszA1Q/VP3IaNUDB6I/AAAAAAAAB4w/6PSIeX6eqUg/s1600-h/20%25255B3%25255D.png"><img title="20" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="20" src="http://lh3.ggpht.com/-SL0LT4SdXtQ/VP3IabWQzeI/AAAAAAAAB40/YEfpmu-9NQs/20_thumb%25255B1%25255D.png?imgmax=800" width="306" height="101"></a><a href="http://lh4.ggpht.com/-XJsl9Vu4lfU/VP3Ia17n_0I/AAAAAAAAB48/YRYimIwGWtY/s1600-h/19%25255B3%25255D.png"><img title="19" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="19" src="http://lh3.ggpht.com/-q4hJVu6Yceo/VP3IbLl1CWI/AAAAAAAAB5E/sfggC2DQfsY/19_thumb%25255B1%25255D.png?imgmax=800" width="551" height="179"></a>&nbsp; </p> <p>To be fair, I really like the workflow provided by the Azure Portal’s <strong>blades</strong>. Let’s say I have an exception:</p> <p>&nbsp;</p> <p><a href="http://lh6.ggpht.com/-SkR_d08tn3A/VP3IblsambI/AAAAAAAAB5Q/AY8ACNygLGE/s1600-h/21%25255B3%25255D.png"><img title="21" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="21" src="http://lh5.ggpht.com/-58phcXmYXSA/VP3IcDen2GI/AAAAAAAAB5Y/qfhMqyUoZ78/21_thumb%25255B1%25255D.png?imgmax=800" width="371" height="186"></a></p> <p>For each level I dig into, a blade opens, so I can easily keep track of the workflow I am following. Very good use for all these 16:9 screens around :) <a href="http://lh4.ggpht.com/-3TRiY_YJua8/VP3Icl9wikI/AAAAAAAAB5g/f_a6QRhQ414/s1600-h/22%25255B3%25255D.png"><img title="22" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="22" src="http://lh4.ggpht.com/-GgpUIbRYSKo/VP3IdYyRlRI/AAAAAAAAB5k/v_Xu5FDLT-8/22_thumb%25255B1%25255D.png?imgmax=800" width="581" height="506"></a> </p> <p><a href="http://lh4.ggpht.com/--9aysp6IwM4/VP3IdnBoEjI/AAAAAAAAB5s/wQ4qeKT7aUY/s1600-h/23%25255B3%25255D.png"><img title="23" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="23" src="http://lh6.ggpht.com/-oRMjJSbBBMg/VP3IeeR3J1I/AAAAAAAAB54/Aeovk_3d6hI/23_thumb%25255B1%25255D.png?imgmax=800" width="582" height="737"></a> </p> <p>The Properties blade is the same for each event, so I can retrieve the <strong>relevant telemetry</strong> in any case. My users for example behaved like this:</p> <p><a href="http://lh5.ggpht.com/-LkcdNAxUnCQ/VP3Ie5k4TVI/AAAAAAAAB58/xpQ7rZIfWZk/s1600-h/24%25255B3%25255D.png"><img title="24" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="24" src="http://lh6.ggpht.com/-9pZeQX2TE2Y/VP3IfIsgkGI/AAAAAAAAB6E/m2wHfKU2kr4/24_thumb%25255B1%25255D.png?imgmax=800" width="553" height="323"></a> </p> <p>It’s a matter of seconds understanding where this issue is.</p> <p>But what if you want more logs? Mostly important, more logs at <strong>lower levels</strong>? Here they are:</p> <p><a href="http://lh4.ggpht.com/-jXjpx3H32A0/VP3IfqbYGMI/AAAAAAAAB6M/Dyob0-oSkws/s1600-h/25%25255B3%25255D.png"><img title="25" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="25" src="http://lh5.ggpht.com/-psELqM8MGzY/VP3IgNbneYI/AAAAAAAAB6U/EEeHCyh2sKY/25_thumb%25255B1%25255D.png?imgmax=800" width="294" height="250"></a></p> <p>Eventually, you get live streaming of the <strong>Application</strong> and <strong>Web Server</strong> Logs:</p> <p><a href="http://lh4.ggpht.com/-ojYfzhsD2y0/VP3IgiuggSI/AAAAAAAAB6c/pZIWo9z0hkE/s1600-h/26%25255B3%25255D.png"><img title="26" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="26" src="http://lh6.ggpht.com/-Bcf1gHptmRw/VP3IhIpYk6I/AAAAAAAAB6k/gDhVrzgaKVA/26_thumb%25255B1%25255D.png?imgmax=800" width="556" height="222"></a></p> <p><a href="http://lh6.ggpht.com/-l7A4z-RTrVE/VP3IhSYP93I/AAAAAAAAB6s/_32LZ_zi-oY/s1600-h/27%25255B3%25255D.png"><img title="27" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="27" src="http://lh6.ggpht.com/-Ld-q3BMpqQA/VP3IiFD8tfI/AAAAAAAAB64/NIAWGltgFho/27_thumb%25255B1%25255D.png?imgmax=800" width="553" height="231"></a></p> <p><a href="http://lh6.ggpht.com/-roe-DvlECSE/VP3IinpW6kI/AAAAAAAAB7A/OdaSRpkkgNs/s1600-h/28%25255B3%25255D.png"><img title="28" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="28" src="http://lh5.ggpht.com/-IRQmfB7Wrsk/VP3IjBoDZrI/AAAAAAAAB7E/LDgEDRZcS-k/28_thumb%25255B1%25255D.png?imgmax=800" width="644" height="151"></a></p> <p>This is actually quite verbose because I set it so, but you have four options to choose from…</p> <p>The new Application Insights is more promising than ever – I am seriously impressed by the effort the team spent on it, Application Insights now feels very solid and it sports even more data than before, without mentioning how integrated it is with Azure.</p>  