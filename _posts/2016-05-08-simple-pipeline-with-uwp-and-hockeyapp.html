---
layout: post
title: Simple pipeline with UWP and HockeyApp
date: '2016-05-08T18:20:00.001+01:00'
author: Matteo Emili
tags: 
modified_time: '2016-05-08T18:20:12.046+01:00'
thumbnail: https://lh3.googleusercontent.com/-WKQAbMjw1Wk/Vy91I2LpRAI/AAAAAAAADIc/Jwtck9rlX0w/s72-c/image_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-3538087377048509294
blogger_orig_url: https://mattvsts.blogspot.com/2016/05/simple-pipeline-with-uwp-and-hockeyapp.html
---

<p>Everybody needs a starting point here and there, so this post would be pretty much about what I did with a very similar situation – a very basic pipeline to push UWP builds to HockeyApp</p> <p>What I wanted was a carefree, easy way of pushing CI builds to HockeyApp so I could enable manual testing for users. Let me add another requirement to the mix – in my case, we are talking about sideloaded apps, and only for x86 and x64. This doesn’t change the actual result though, we’ll talk about ARM at the end.</p> <p><a href="https://lh3.googleusercontent.com/-L4x1FgSyK_M/Vy91IMqByuI/AAAAAAAADIU/7r2MqVrXaqM/s1600-h/image%25255B2%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-WKQAbMjw1Wk/Vy91I2LpRAI/AAAAAAAADIc/Jwtck9rlX0w/image_thumb.png?imgmax=800" width="244" height="161"></a></p> <p>This is the pipeline I was talking about.</p> <p>The first step is a PowerShell script – what it does is to change the value of the last build number in the appxmanifest so that each build will upload a new version of the app to HockeyApp. The service identifies a new build from its build number, so what I did is just changing the revision number with the BuildId of my Build. Simple as that.</p> <p>Then the build restores the NuGet packages, and builds my app for x86 first and x64 then. The reason why I went down this route is because I wanted to keep things as simple as possible, with a very intuitive tree structure and preparing the folder for the Zip task I used next.</p> <p>I decided to use a Zip Directories <a href="https://marketplace.visualstudio.com/items?itemName=petergroenewegen.PeterGroenewegen-Xpirit-Vsts-Build-Zip">task</a> from fellow MVP <a href="https://twitter.com/pgroene">Peter Groenewegen</a>. Building a task from scratch wasn’t in the cards because of time constraints in this case, and Peter’s did the job as required.</p> <p><a href="https://lh3.googleusercontent.com/-n0KisXH_9-w/Vy91JrUWseI/AAAAAAAADIk/oVZ0lHW9ZWw/s1600-h/image%25255B5%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-sGGzLT-RVe8/Vy91KSv_M4I/AAAAAAAADIs/TjQdi6lOfzY/image_thumb%25255B1%25255D.png?imgmax=800" width="244" height="38"></a></p> <p>The task would create a zip file of the <strong>App_1.0.0.$(Build.BuildId)_Test</strong> folder. This zip file contains the build artifacts I am feeding to VSTS and HockeyApp.</p> <p>Small shortcut, but this works well <img class="wlEmoticon wlEmoticon-smile" style="border-top-style: none; border-left-style: none; border-bottom-style: none; border-right-style: none" alt="Smile" src="https://lh3.googleusercontent.com/-9In634VZ2bA/Vy91K_YuAFI/AAAAAAAADI0/2h_WeunWb58/wlEmoticon-smile%25255B2%25255D.png?imgmax=800"> basically this name comes out from the AppxBundle process, and the BuildId is there because I changed the appxmanifest file with it so it is nicely available everywhere in my build. This could be extended with a build variable though.</p> <p>After uploading the symbols, the build uploads the artifacts:</p> <p><a href="https://lh3.googleusercontent.com/-H_jrMaOU7j0/Vy91LzhB4DI/AAAAAAAADI8/hefQ-y-QmgU/s1600-h/image%25255B8%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-0Mjj3HERI7Y/Vy91MceLhcI/AAAAAAAADJE/7lBi3JN_v5A/image_thumb%25255B2%25255D.png?imgmax=800" width="244" height="100"></a></p> <p>from the folder I used as a destination when building, the build engine searches for the zip file I created previously with the task. It is a Server artifacts, meaning it is stored in VSTS.</p> <p>Eventually, HockeyApp is fed with this file:</p> <p><a href="https://lh3.googleusercontent.com/-3hK4w16t9YY/Vy91NPD213I/AAAAAAAADJM/9sUxFCKmcts/s1600-h/image%25255B11%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-LPIEcn5O3hI/Vy91OC7CERI/AAAAAAAADJU/zRs3QXXzn-w/image_thumb%25255B3%25255D.png?imgmax=800" width="244" height="31"></a></p> <p><a href="https://lh3.googleusercontent.com/-3wY1AlICYXM/Vy91O6q6ufI/AAAAAAAADJc/9bG860wVHbI/s1600-h/image%25255B17%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-rhk27_-A-FM/Vy91PxcD0vI/AAAAAAAADJk/1AdKzkpOAhI/image_thumb%25255B5%25255D.png?imgmax=800" width="244" height="61"></a></p> <p>The connection comes from the <strong>Service Endpoint</strong> you need with HockeyApp. The App ID is the one you’ll find on HockeyApp and the Binary File Path is where the source for the zip file you need to upload is. Simple as that.</p> <p>In HockeyApp you’ll see the build as soon as the process is over:</p> <p><a href="https://lh3.googleusercontent.com/-LIPXhp4l3hY/Vy91QkxeqHI/AAAAAAAADJs/gXceIinV2Lg/s1600-h/image%25255B20%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-yRNRKrTvbtk/Vy91RD1iiFI/AAAAAAAADJ0/Hn7LOnp2-xc/image_thumb%25255B6%25255D.png?imgmax=800" width="244" height="75"></a></p> <p>The zip files the build uploads contains these files:</p> <p><a href="https://lh3.googleusercontent.com/-iYouQ4Qi8kk/Vy91R3AWMQI/AAAAAAAADJ8/olqzKriTYi4/s1600-h/image%25255B23%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-FzD14Awf3sE/Vy91StNQ1XI/AAAAAAAADKE/wafUQZ88Cgc/image_thumb%25255B7%25255D.png?imgmax=800" width="244" height="180"></a></p> <p>which is exactly what you would get from the <strong>Create Package</strong> wizard in Visual Studio. Running the PowerShell script installs the app on the target system.</p> <p>I mentioned ARM at the beginning – to add ARM to this pipeline you’ll need to add another build step for ARM, and then uploading the appx file generated by the build. </p> <p>It is a slightly different process at the moment, and this requires a different provision on HockeyApp as well: the ARM app needs to be separate from the UWP one at the moment so you can upload the build artifact.</p>