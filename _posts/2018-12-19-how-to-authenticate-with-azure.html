---
layout: post
title: How to authenticate with the Azure subscription you select in a custom PowerShell
  Azure DevOps task
date: '2018-12-19T08:42:00.000Z'
author: Matteo Emili
tags: 
modified_time: '2018-12-19T08:42:15.614Z'
thumbnail: https://1.bp.blogspot.com/-Ffbi5-i1SlY/XBoDsezvwGI/AAAAAAAAFO4/cZb2gaGRDdgeoUFrOoKpdNX75--k2rqAwCLcBGAs/s72-c/azps0.PNG
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-5069084908401032488
blogger_orig_url: https://mattvsts.blogspot.com/2018/12/how-to-authenticate-with-azure.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">I will cover more about my custom PowerShell Azure DevOps task, but I wanted to share this quick tip as I struggled as much as the next guy about it...<br /><br />Say that you want to re-use your PowerShell scripts, and instead of having inline PowerShell tasks you want to package them properly for cross-organisational re-use. It is a relatively easy and straightforward task, but chances are you are going to target an Azure subscription with it and you want to have the nice dropbox and the integrated experience you get with first party tasks.<br /><br />It is not really difficult, but for some reasons I could not really find an easy walkthrough about that - a limited set of steps, but somehow hard to find...<br /><br />What you need to do is to import the <a href="https://github.com/Microsoft/azure-pipelines-tasks/tree/master/Tasks/Common/VstsAzureHelpers_">VstsAzureHelpers&nbsp;</a>&nbsp;module and include it in the PowerShell modules consumed by your task. Once that is done, you need to make sure you can select the Azure Subscription in the parameters - easy to do as you need to edit the task.json file:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-Ffbi5-i1SlY/XBoDsezvwGI/AAAAAAAAFO4/cZb2gaGRDdgeoUFrOoKpdNX75--k2rqAwCLcBGAs/s1600/azps0.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="178" data-original-width="569" src="https://1.bp.blogspot.com/-Ffbi5-i1SlY/XBoDsezvwGI/AAAAAAAAFO4/cZb2gaGRDdgeoUFrOoKpdNX75--k2rqAwCLcBGAs/s1600/azps0.PNG" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />After this you can finally use the <b>Initialize-Azure</b> command in your PowerShell script, which is going to automatically pick the subscription from the parameter and initialise the relevant cmdlets so that you can use stuff like Set-AzureRM... without running <b>Login-AzureRmAccount</b>.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-Ykwos8Im4cg/XBoEAsaSMoI/AAAAAAAAFPA/W5QC-5Sh1u4jnHXD4MIiJ6NfppVGwzGrQCLcBGAs/s1600/azps1.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="125" data-original-width="476" src="https://2.bp.blogspot.com/-Ykwos8Im4cg/XBoEAsaSMoI/AAAAAAAAFPA/W5QC-5Sh1u4jnHXD4MIiJ6NfppVGwzGrQCLcBGAs/s1600/azps1.PNG" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br />Easier done than said ðŸ˜€ I hope it is going to be helpful!</div>