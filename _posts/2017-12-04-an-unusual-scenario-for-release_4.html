---
layout: post
title: 'An unusual scenario for Release Management, part 2: production SonarQube upgrades'
date: '2017-12-04T09:42:00.001Z'
author: Matteo Emili
tags: 
modified_time: '2017-12-04T09:42:42.862Z'
thumbnail: https://lh3.googleusercontent.com/-Hs9c3ASrL-Y/WiUYWi5Wq1I/AAAAAAAAEwg/Djmu61GWHcQb9c_Rv2bgB9VePGfi8RbZwCHMYCw/s72-c/image_thumb2?imgmax=800
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-3890000356595942760
blogger_orig_url: https://mattvsts.blogspot.com/2017/12/an-unusual-scenario-for-release_4.html
---

<p>In the previous post we saw how you can automate SonarQube test upgrades, but now it is time for production.</p><p>As mentioned, my artifacts here will be the TFVC repository, and I am going to have just one environment as target: Production.</p><p><a href="https://lh3.googleusercontent.com/-aJ14SndfH7w/WiUYVlfUQnI/AAAAAAAAEwc/zLf3wLwAucIWmJkakK9-ZS6nzGixFoQ0QCHMYCw/s1600-h/image6"><img width="504" height="304" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Hs9c3ASrL-Y/WiUYWi5Wq1I/AAAAAAAAEwg/Djmu61GWHcQb9c_Rv2bgB9VePGfi8RbZwCHMYCw/image_thumb2?imgmax=800" border="0"></a></p><p>There are three phases here, two Deployment Group phases and an Agentless phase. This is also where Tags come into play:</p><p><a href="https://lh3.googleusercontent.com/-9kw0TNAUZh8/WiUYXuf9JyI/AAAAAAAAEwk/rQBrF8HqwjsUBIt0IIshlnO-O_4Ao2wDACHMYCw/s1600-h/image10"><img width="504" height="283" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-e73w2xgeFN4/WiUYYvoWIzI/AAAAAAAAEwo/3rHuN576TioIMa9if2vuXvdJ8qsjdqNZACHMYCw/image_thumb4?imgmax=800" border="0"></a></p><p>The Release Definition itself is going to be fairly straightforward – after all, I am assuming testing already happened so this automation is just aimed at saving time:</p><p><a href="https://lh3.googleusercontent.com/-zvF49XbM_Ag/WiUYZYvicrI/AAAAAAAAEws/obMdnmMGiOwdRCF9C-jzvVYYiTS90fT9ACHMYCw/s1600-h/image14"><img width="504" height="706" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-yRocixZAsvw/WiUYaUMgALI/AAAAAAAAEww/jQ3m8rV-Egw41k1mjTa4IrB7NdLTz1ewACHMYCw/image_thumb6?imgmax=800" border="0"></a></p><p>The first phase will prepare the environment for the upgrade itself. It is going to copy the zip file to the location we’d like to use, unblock and extract the ZIP file, copy the plugins in use to the new instance and so on.</p><p>I am also using these variables to keep the process reusable, and I am taking the ALM Rangers template as a starting point, so everything will happen into C:\sq\:</p><p><a href="https://lh3.googleusercontent.com/-D4b2NAN0T74/WiUYbEpA1pI/AAAAAAAAEw0/t54hA4ljcJgbA9mqc8woyvy6ks_F9xGIgCHMYCw/s1600-h/image19"><img width="503" height="112" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-J1woEB3wE10/WiUYcJH-gdI/AAAAAAAAEw4/9Bv2JcOh8u4NVMEYWCqwN7NopTj-6cHfgCHMYCw/image_thumb9?imgmax=800" border="0"></a></p><p><a href="https://lh3.googleusercontent.com/--MjEpRxdoQo/WiUYc_1qR0I/AAAAAAAAEw8/tS98ADgMAI82Jb-0YfYDiBBhujitNU9OwCHMYCw/s1600-h/image22"><img width="186" height="76" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-4tFB5o3h8b0/WiUYd5PsJlI/AAAAAAAAExA/NRro-gNnb581smQ20Kn8GxDX3hNBQjgTQCHMYCw/image_thumb10?imgmax=800" border="0"></a></p><p><a href="https://lh3.googleusercontent.com/-EYmq4FByvzA/WiUYeyaBy7I/AAAAAAAAExE/763OZ6hv9lUoedykm8x0dMXIAxn_TCabwCHMYCw/s1600-h/image27"><img width="504" height="305" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-31ELn0qoctU/WiUYf1jP9ZI/AAAAAAAAExI/xGhmf6iJd5wdtbrqufNxg7d0feHT8vMRQCHMYCw/image_thumb13?imgmax=800" border="0"></a></p><p>The <strong>Start SonarQube Interactive</strong> launches StartSonar.bat from PowerShell to make sure it is not going to make the task hang and run indefinitely.</p><p><a href="https://lh3.googleusercontent.com/-diT2iPyY9q0/WiUYgt_upAI/AAAAAAAAExM/gg32_0T9gMoEwOrkZMImkZibOlcZSev7QCHMYCw/s1600-h/image32"><img width="504" height="87" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-w4sGfRzk9WA/WiUYhjFE0WI/AAAAAAAAExQ/4BDEOk3oJ6QK3O6saQh9yInYb9iZ_3_TwCHMYCw/image_thumb16?imgmax=800" border="0"></a></p><p>The Agentless phase is required because once you launch StartSonar.bat you will have to browse to the /setup URL and start the upgrade process. </p><p>I am going to get a notification (it could be anyone else here, even a group) and I am going to start the process. You could automate that, but it is surely better to do so manually IMHO. </p><p><a href="https://lh3.googleusercontent.com/-pWaSa70Ewc8/WiUYinbf3tI/AAAAAAAAExU/q6ZnVriRKOItZvun_17juUqII711LopXACHMYCw/s1600-h/image36"><img width="504" height="500" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-lTmYxf5BX-s/WiUYjTTNAEI/AAAAAAAAExY/3YvIAeur_38chg21lD_7N6qrIoFXm7uuACHMYCw/image_thumb18?imgmax=800" border="0"></a></p><p>Once the upgrade is completed (and you stopped the StartSonar batch job, again I could automate this too but I am happy to have it included in the manual interaction for now) you can resume the pipeline with the second Deployment Group phase, which is going to remove the old service, install the new one and start it using the OOB batch scripts in your SonarQube instance.</p><p>This saves time (remember you can schedule this Release Definition too <img class="wlEmoticon wlEmoticon-smile" alt="Smile" src="https://lh3.googleusercontent.com/-Hxsd9LLXGuI/WiUYkbvXw2I/AAAAAAAAExc/PeB92aLqwl4Z25Hc6of59yAffnp7GfHZACHMYCw/wlEmoticon-smile2?imgmax=800">) but the most important takeaway here is the value you get from automating the process and versioning your configurations. </p><p>It might be unorthodox, but it works quite well IMHO.</p>