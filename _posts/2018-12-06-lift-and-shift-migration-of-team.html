---
layout: post
title: Lift and shift migration of Team Foundation Server to Azure with Azure DevOps
  Server 2019
date: '2018-12-06T19:58:00.003Z'
author: Matteo Emili
tags: 
modified_time: '2018-12-06T19:58:59.950Z'
thumbnail: https://2.bp.blogspot.com/-Z9Au0csb5tg/XAl9aYwKHRI/AAAAAAAAFLs/CMMD-q6WZTAo_eD005dLgK6abbngm42agCLcBGAs/s72-c/azdo-ls1.png
blogger_id: tag:blogger.com,1999:blog-9050180307874313601.post-4455045512465420809
blogger_orig_url: https://mattvsts.blogspot.com/2018/12/lift-and-shift-migration-of-team.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">This is a consequence of the support for Azure SQL Database - as you can use it as a data tier now, you can also upgrade your existing Team Foundation Server instance to Azure DevOps in a lift and shift fashion.<br /><br />First of all -- *this works on my machine* (lab) and *I bear no responsibilities* üòÅ it is highly experimental and only with Azure DevOps Server 2019 RC1 - although I am sure it is going to be polished in the next releases. Let's review the pre-requisites:<br /><br /><ul style="text-align: left;"><li>You need to run domain-joined VM(s)</li><li>The(se) VM(s) must have a Managed Identity in order to access Azure SQL Database<br /></li></ul>In order to lift and shift your databases, you need to import them into Azure SQL Database. You can use many methods like the Microsoft Data Migration Assistant, SSMS or a manual import.<br /><br /><a href="https://2.bp.blogspot.com/-Z9Au0csb5tg/XAl9aYwKHRI/AAAAAAAAFLs/CMMD-q6WZTAo_eD005dLgK6abbngm42agCLcBGAs/s1600/azdo-ls1.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="653" data-original-width="680" height="383" src="https://2.bp.blogspot.com/-Z9Au0csb5tg/XAl9aYwKHRI/AAAAAAAAFLs/CMMD-q6WZTAo_eD005dLgK6abbngm42agCLcBGAs/s400/azdo-ls1.png" width="400" /></a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />It is likely that you need to remove all the Windows users, and the table and stored procedures used for the scheduled backups. Remember that as of now it is still an experimental process - no support whatsoever for this, especially because you are modifying the database manually!<br /><br /><a href="https://3.bp.blogspot.com/-MGM-VFVf_sM/XAl9aJ33BVI/AAAAAAAAFLo/xt01-S3E2Vk_6_A5GSPqhZxWB1o-Ffg1gCLcBGAs/s1600/exportazdo_collection.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="391" data-original-width="607" src="https://3.bp.blogspot.com/-MGM-VFVf_sM/XAl9aJ33BVI/AAAAAAAAFLo/xt01-S3E2Vk_6_A5GSPqhZxWB1o-Ffg1gCLcBGAs/s1600/exportazdo_collection.png" /></a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />Once the database are imported (S3 tier or above!) you need to run this query on the Azure DevOps databases:<br /><br /><div class="MsoNormal"><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">CREATE</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">USER</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> &lt;vmname&gt; </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">FROM</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">EXTERNAL</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">PROVIDER</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"><o:p></o:p></span></div><br /><div class="MsoNormal"><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">ALTER</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">ROLE</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> db_owner </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">ADD</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> MEMBER &lt;vmname&gt;<o:p></o:p></span></div><div class="MsoNormal"><span style="background-color: white;"><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: blue; font-family: Consolas; font-size: 9.5pt;">ALTER</span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: blue; font-family: Consolas; font-size: 9.5pt;">USER</span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; font-family: Consolas; font-size: 9.5pt;"> &lt;vmname&gt; </span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: blue; font-family: Consolas; font-size: 9.5pt;">WITH</span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: blue; font-family: Consolas; font-size: 9.5pt;">DEFAULT_SCHEMA</span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; color: grey; font-family: Consolas; font-size: 9.5pt;">=</span></span><span lang="EN-US" style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; font-family: Consolas; font-size: 9.5pt;"><span style="background-color: white;">dbo</span><span style="background-color: yellow;"><o:p></o:p></span></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US">Followed by this query in the master database:<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">CREATE</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">USER</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> &lt;vmname&gt; </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">FROM</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">EXTERNAL</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">PROVIDER</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"><o:p></o:p></span></div><br /><div class="MsoNormal"><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">ALTER</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">ROLE</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> dbmanager </span><span lang="EN-US" style="background: white; color: blue; font-family: Consolas; font-size: 9.5pt; mso-ansi-language: EN-US; mso-highlight: white;">ADD</span><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"> MEMBER &lt;vmname&gt;<o:p></o:p></span></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"><span style="font-family: &quot;Times New Roman&quot;; font-size: small;">This is it really - then you can launch your Azure DevOps Server Configuration Wizard and proceed to an upgrade. Yes, even if you already installed Azure DevOps Server! Of course there are changes to perform here, so it makes sense to call it as such:</span></span></div><div class="MsoNormal"><span lang="EN-US" style="background: white; font-family: Consolas; font-size: 9.5pt;"><br /></span></div><div class="separator" dir="rtl" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-sznhHbW77Fg/XAl9aEtulDI/AAAAAAAAFLk/mPkaqouyBYURW3BwW74b5T0j2wj3xCPwACLcBGAs/s1600/azdo-ls0.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="294" data-original-width="516" src="https://2.bp.blogspot.com/-sznhHbW77Fg/XAl9aEtulDI/AAAAAAAAFLk/mPkaqouyBYURW3BwW74b5T0j2wj3xCPwACLcBGAs/s1600/azdo-ls0.png" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></div>